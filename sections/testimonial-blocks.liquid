{{- 'customer-testimonials-wrapp.css' | asset_url | stylesheet_tag -}}
{%- liquid
	assign color_bg = section.settings.color_bg | downcase
	assign color_heading = section.settings.color_heading
	assign color_text = section.settings.color_text
	assign color_links = section.settings.color_links

	assign disable_top_spacing = section.settings.disable_top_spacing
	assign disable_bottom_spacing = section.settings.disable_bottom_spacing

	assign heading_class = ''
	if color_heading contains 'gradient'
		assign heading_class = 'heading-has-gradient'
	endif

	assign color_body_bg = settings.color_body_bg | downcase

	assign transparent = false
	if color_body_bg == color_bg or color_bg == 'transparent' or color_bg == 'rgba(0,0,0,0)'
		assign transparent = true
	endif

	assign desktop_spacing_top = section.settings.desktop_spacing_top
	assign desktop_spacing_bottom = section.settings.desktop_spacing_bottom
	assign mobile_spacing_top = section.settings.mobile_spacing_top
	assign mobile_spacing_bottom = section.settings.mobile_spacing_bottom
	assign disable_top_spacing = section.settings.disable_top_spacing
	assign disable_bottom_spacing = section.settings.disable_bottom_spacing
-%}

{% style %}
	#shopify-section-{{ section.id }} {
		--section-spacing-mobile-top: {{ mobile_spacing_top | default: '15' | append: 'px' }};
		--section-spacing-mobile-bottom: {{ mobile_spacing_bottom | default: '15' | append: 'px' }};
		--section-spacing-desktop-top: {{ desktop_spacing_top | default: '30' | append: 'px' }};
		--section-spacing-desktop-bottom: {{ desktop_spacing_bottom | default: '30' | append: 'px' }};
	}
{% endstyle %}

<div class="customer-testimonials-ctr customer-testimonials-ctr--transparent-{{ transparent }} {% if transparent %}section-spacing{% else %}section-spacing-padding{% endif %} {% if disable_top_spacing %} section-spacing--disable-top{% endif %}{% if disable_bottom_spacing %} section-spacing--disable-bottom{% endif %}" style="--color-bg: {{ color_bg }}; --color-heading: {{ color_heading }}; --color-text: {{ color_text }}; --solid-button-background: {{ color_text }}; --bg-body: {{ color_bg }}; --color-accent: {{ color_links }}; --color-accent-rgb: {{ color_links.rgb | replace: ' ' , ',' }};">
  <div class="row">
    <div class="small-12 columns service-block-section">

      <div class="service-block-wrpp">
        <div class="ugc-grid-all">
        {% for service in page.metafields.custom.customer_reviews_and_testimonials.value %}
          {% assign loopindex = forloop.index | modulo:3 %}
          {% if loopindex == 0 %}
          <div class="service-block {{ heading_class }}">
            {% if service.review_content != blank %}
              <div class="service-description">
                {{ service.review_content | metafield_tag }}
              </div>
            {% endif %}
            {% if service.users != blank %}
              <div class="service-heading body-small">-{{ service.users }}</div>
            {% endif %}
          </div>
         {% endif %}
        {% endfor %}
        </div>
        <div class="ugc-grid-all">
        {% for service in page.metafields.custom.customer_reviews_and_testimonials.value %}
          {% assign loopindex = forloop.index | modulo:3 %}
          {% if loopindex == 1 %}
          <div class="service-block {{ heading_class }}">
            {% if service.review_content != blank %}
              <div class="service-description">
                {{ service.review_content | metafield_tag }}
              </div>
            {% endif %}
            {% if service.users != blank %}
              <div class="service-heading body-small">-{{ service.users }}</div>
            {% endif %}
          </div>
         {% endif %}
        {% endfor %}
        </div>
        <div class="ugc-grid-all">
        {% for service in page.metafields.custom.customer_reviews_and_testimonials.value %}
          {% assign loopindex = forloop.index | modulo:3 %}
          {% if loopindex == 2 %}
          <div class="service-block {{ heading_class }}">
            {% if service.review_content != blank %}
              <div class="service-description">
                {{ service.review_content | metafield_tag }}
              </div>
            {% endif %}
            {% if service.users != blank %}
              <div class="service-heading body-small">-{{ service.users }}</div>
            {% endif %}
          </div>
         {% endif %}
        {% endfor %}
        </div>
      </div>

      <div class="load-more-review">
        <div class="load-more-reviewbtn">Load More</div>
      </div>

    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const wrapper = document.querySelector(".service-block-wrpp");
  const section = wrapper.closest(".service-block-section");
  const button = section.querySelector(".load-more-reviewbtn");

  const maxHeight = 1000;

  const checkHeight = () => {
    const totalHeight = wrapper.scrollHeight;

    if (totalHeight > maxHeight) {
      section.classList.add("collapsed");
      section.classList.remove("expanded");
      button.parentElement.style.display = "block";
      button.textContent = "Load more";
    } else {
      section.classList.remove("collapsed", "expanded");
      button.parentElement.style.display = "none";
    }
  };

  checkHeight();

  button.addEventListener("click", () => {
    if (section.classList.contains("collapsed")) {
      section.classList.remove("collapsed");
      section.classList.add("expanded");
      button.textContent = "Load less";
    } else {
      section.classList.remove("expanded");
      section.classList.add("collapsed");
      button.textContent = "Load more";
    }
  });
});
</script>

{% schema %}
  	{
      "name": "Customer Testimonials",
      "class": "customer-testimonials-wrapp",
      "settings": [
        {
          "type": "header",
          "content": "Colors"
        },
        {
          "type": "color",
          "id": "color_bg",
          "label": "Background",
          "default": "transparent"
        },
        {
          "type": "color_background",
          "id": "color_heading",
          "label": "Heading",
          "default": "#1a1c1d"
        },
        {
          "type": "color",
          "id": "color_text",
          "label": "Text",
          "default": "#2c2d2e"
        },
        {
          "type": "color",
          "id": "color_links",
          "label": "Links",
          "default": "#2c2d2e"
        },
        {
          "type": "header",
          "content": "Spacing"
        },
        {
          "type": "checkbox",
          "id": "disable_top_spacing",
          "default": false,
          "label": "Remove top spacing"
        },
        {
          "type": "checkbox",
          "id": "disable_bottom_spacing",
          "default": false,
          "label": "Remove bottom spacing"
        },
        
        {
          "type": "header",
          "content": "Desktop spacing"
        },
        {
          "type": "range",
          "id": "desktop_spacing_top",
          "min": 0,
          "max": 200,
          "step": 5,
          "unit": "px",
          "label": "Desktop spacing top",
          "default": 100,
          "info": "Changes the section top spacing in desktop screens."
        },
        {
          "type": "range",
          "id": "desktop_spacing_bottom",
          "min": 0,
          "max": 200,
          "step": 5,
          "unit": "px",
          "label": "Desktop spacing bottom",
          "default": 100,
          "info": "Changes the section bottom spacing in desktop screens."
        },
        {
          "type": "header",
          "content": "Mobile spacing"
        },
        {
          "type": "range",
          "id": "mobile_spacing_top",
          "min": 0,
          "max": 200,
          "step": 5,
          "unit": "px",
          "label": "Mobile spacing top",
          "default": 50,
          "info": "Changes the section top spacing in mobile screens."
        },
        {
          "type": "range",
          "id": "mobile_spacing_bottom",
          "min": 0,
          "max": 200,
          "step": 5,
          "unit": "px",
          "label": "Mobile spacing bottom",
          "default": 50,
          "info": "Changes the section bottom spacing in mobile screens."
        }
      ],
    	"presets": [
			{
				"name": "Customer Testimonials",
				"blocks": [
				]
			}
		],
		"enabled_on": {
			"templates": ["*"],
			"groups": [
				"header", "footer"
			]
		}
  }
{% endschema %}
