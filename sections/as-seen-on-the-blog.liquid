{% if article.metafields.custom.as_seen_on_the_blog.value != blank %}
  {{ 'featured-collection.css' | asset_url | stylesheet_tag }}
  {{ 'heating-systems-grid.css' | asset_url | stylesheet_tag }}
  {%- liquid
    assign section_heading = section.settings.heading
    assign marker_style = section.settings.marker_style
    assign section_description = section.settings.description
    assign display_type = section.settings.display_type
    assign columns_desktop = section.settings.columns_desktop
    assign product_limit = section.settings.product_limit
    assign mobile_swipe = section.settings.mobile_swipe
    assign show_progress_bar = section.settings.show_progress_bar

    assign marker_color = section.settings.marker_color

    assign disable_top_spacing = section.settings.disable_top_spacing
    assign disable_bottom_spacing = section.settings.disable_bottom_spacing
    assign columns_class = 'small-6 medium-6 large-4'
    case columns_desktop
      when 2
        assign columns_class = 'small-6 medium-6'
      when 3
        assign columns_class = 'small-6 medium-4'
      when 4
        assign columns_class = 'small-6 medium-6 large-3'
      when 5
        assign columns_class = 'small-6 medium-3 large-1/5'
      when 6
        assign columns_class = 'small-6 medium-3 large-2'
    endcase

    if display_type == 'carousel'
      assign element = 'slide-show'
    else
      assign element = 'div'
    endif

    assign desktop_spacing_top = section.settings.desktop_spacing_top
    assign desktop_spacing_bottom = section.settings.desktop_spacing_bottom
    assign mobile_spacing_top = section.settings.mobile_spacing_top
    assign mobile_spacing_bottom = section.settings.mobile_spacing_bottom
    assign disable_top_spacing = section.settings.disable_top_spacing
    assign disable_bottom_spacing = section.settings.disable_bottom_spacing
  -%}

  {% style %}
    #shopify-section-{{ section.id }} {
      --section-spacing-mobile-top: {{ mobile_spacing_top | default: '15' | append: 'px' }};
      --section-spacing-mobile-bottom: {{ mobile_spacing_bottom | default: '15' | append: 'px' }};
      --section-spacing-desktop-top: {{ desktop_spacing_top | default: '30' | append: 'px' }};
      --section-spacing-desktop-bottom: {{ desktop_spacing_bottom | default: '30' | append: 'px' }};
    }
  {% endstyle %}
  <div class="featured-collection{% if mobile_swipe %} swipe-on-mobile{% endif %} section-spacing{% if disable_top_spacing %} section-spacing--disable-top{% endif %}{% if disable_bottom_spacing %} section-spacing--disable-bottom{% endif %}">
    <div class="row">
      <div class="small-12 columns">
        {% render 'section-header', section_heading: section_heading, section_description: section_description,  marker_color: marker_color, marker_style: marker_style %}
        <div class="featured-collection__inner display-type--{{ display_type }}">
          <{{ element }} id="product-grid-{{ section.id }}" class="products row {{ display_type }}" data-dots="true">					
            {%- for heating_systems in article.metafields.custom.as_seen_on_the_blog.value limit: product_limit -%}
              <div class="{{ columns_class }} columns {% if display_type == 'carousel' %}carousel__slide{% endif %}">
                <div class="heating-systems-inner">                
                  {% if heating_systems.image != blank %}
                    <figure>                
                      {%- liquid
                        assign image = heating_systems.image.value
                        assign master_width = image.src.width | append: 'x' | append: image.src.height
                        render 'responsive-image', image: image, sizes: master_width, retina: false, alt: heating_systems.title
                      -%}
                    </figure>
                  {% endif %}
                  <div class="heating-systems-content">
                    {% if heating_systems.title != blank %} <div class="title body-small">{{ heating_systems.title }}</div> {% endif %}
                    {% if heating_systems.content != blank %} <div class="rte body-extra-small">{{ heating_systems.content | metafield_text }}</div> {% endif %}
                    <div class="heating-systems-button">
                      <button class="read-more-btn">Read more</button>
                      <a href="{{ heating_systems.url }}" class="button shop_button small" aria-label="{{ heating_systems.title }}">Shop</a>
                    </div>
                  </div>
                </div>
              </div>  
            {%- endfor -%}   
            {%- if display_type == 'carousel' -%}
              {%- if product_limit > columns_desktop -%}
              <div class="flickity-nav flickity-prev" tabindex="0">{% render 'svg-icons' with 'carousel-prev' %}</div>
              <div class="flickity-nav flickity-next" tabindex="0">{% render 'svg-icons' with 'carousel-next' %}</div>
              {%- endif -%}
            {%- endif -%}
          </{{ element }}>
          {%- if display_type == 'carousel' and show_progress_bar -%}
            <div class="flickity-progress">
              <div class="flickity-progress--bar"></div>
            </div>
          {%- endif -%}
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const contents = document.querySelectorAll(".heating-systems-content .rte");
      const buttons = document.querySelectorAll(".heating-systems-button .read-more-btn");
      buttons.forEach((btn, index) => {
        const content = contents[index];
        if (!content) return;
        
        btn.addEventListener("click", function () {
          content.classList.toggle("expanded");
          
          if (content.classList.contains("expanded")) {
            btn.textContent = "Read less";
          } else {
            btn.textContent = "Read more";
          }
        });
      });
    })
  </script>
{% endif %}


{% schema %}
{
	"name": "As seen on the blog",
	"class": "section-featured-collection heating-systems-grid",
	"settings": [
		{
			"type": "text",
			"id": "heading",
			"label": "Heading",
			"default": "Featured Collection",
			"info": "Wrap your text between | to add animated markers. For example: Animated |marker| will underline marker text."
		},
		{
			"type": "select",
			"id": "marker_style",
			"options": [
				{
					"value": "style1",
					"label": "Basic"
				},
				{
					"value": "style2",
					"label": "Double"
				},
				{
					"value": "style3",
					"label": "Squiggle"
				},
				{
					"value": "style4",
					"label": "Zigzag"
				}
			],
			"default": "style1",
			"label": "Marker"
		},
		{
			"type": "richtext",
			"id": "description",
			"label": "Description",
			"default": "<p>Describe your featured collection here</p>"
		},
		{
			"type": "header",
			"content": "Collection"
		},		
		{
			"type": "select",
			"id": "display_type",
			"options": [
				{
					"value": "grid",
					"label": "Grid"
				},
				{
					"value": "carousel",
					"label": "Carousel"
				}
			],
			"default": "grid",
			"label": "Display type"
		},
		{
			"type": "range",
			"id": "product_limit",
			"min": 2,
			"max": 12,
			"step": 1,
			"label": "Maximum products to show",
			"default": 4
		},
		{
			"type": "range",
			"id": "columns_desktop",
			"min": 2,
			"max": 6,
			"step": 1,
			"default": 4,
			"label": "Number of columns on desktop"
		},		
		{
			"type": "header",
			"content": "Grid"
		},
		{
			"type": "checkbox",
			"id": "mobile_swipe",
			"default": true,
			"label": "Enable swipe on mobile"
		},
		{
			"type": "header",
			"content": "Carousel"
		},
		{
			"type": "checkbox",
			"id": "show_progress_bar",
			"label": "Show progress bar",
			"default": true
		},
		{
			"type": "header",
			"content": "Colors"
		},
		{
			"type": "color",
			"id": "marker_color",
			"label": "Marker",
			"default": "#FD6262"
		},
		{
			"type": "header",
			"content": "Spacing"
		},
		{
			"type": "checkbox",
			"id": "disable_top_spacing",
			"default": false,
			"label": "Remove top spacing"
		},
		{
			"type": "checkbox",
			"id": "disable_bottom_spacing",
			"default": false,
			"label": "Remove bottom spacing"
		},
		{
			"type": "header",
			"content": "Desktop spacing"
		},
		{
			"type": "range",
			"id": "desktop_spacing_top",
			"min": 0,
			"max": 200,
			"step": 5,
			"unit": "px",
			"label": "Desktop spacing top",
			"default": 100,
			"info": "Changes the section top spacing in desktop screens."
		},
		{
			"type": "range",
			"id": "desktop_spacing_bottom",
			"min": 0,
			"max": 200,
			"step": 5,
			"unit": "px",
			"label": "Desktop spacing bottom",
			"default": 100,
			"info": "Changes the section bottom spacing in desktop screens."
		},
		{
			"type": "header",
			"content": "Mobile spacing"
		},
		{
			"type": "range",
			"id": "mobile_spacing_top",
			"min": 0,
			"max": 200,
			"step": 5,
			"unit": "px",
			"label": "Mobile spacing top",
			"default": 50,
			"info": "Changes the section top spacing in mobile screens."
		},
		{
			"type": "range",
			"id": "mobile_spacing_bottom",
			"min": 0,
			"max": 200,
			"step": 5,
			"unit": "px",
			"label": "Mobile spacing bottom",
			"default": 50,
			"info": "Changes the section bottom spacing in mobile screens."
		}
	],
	"presets": [
		{
			"name": "As seen on the blog"
		}
	],
	"enabled_on": {
		"templates": ["article"],
		"groups": [
			"header", "footer"
		]
	}
}
{% endschema %}
